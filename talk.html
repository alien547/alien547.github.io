<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æ¶ˆæ¯å¢™ Â· GitHub Pages + Vercel</title>
</head>
<body>
  <h1>ğŸ’¬ å‰åç«¯åˆ†ç¦»æ¶ˆæ¯å¢™ï¼ˆGitHub Pages + Vercelï¼‰</h1>
  <div>
    <input id="username" placeholder="æ˜µç§°" value="åŒ¿å" />
    <input id="message" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." />
    <button id="send">å‘é€</button>
  </div>
  <div id="messages" style="border:1px solid #ccc; height:300px; overflow:auto; padding:10px; margin-top:10px;"></div>

  <script>
    // âš ï¸ è¿™é‡Œæ”¹æˆä½ çš„ Vercel åç«¯åŸŸåï¼ˆä¸è¦æœ«å°¾æ–œæ ï¼‰
    const WORKER_URL = 'https://alien547-wall-api.vercel.app';

    function displayMessage(msg) {
      const div = document.createElement('div');
      div.style.margin = '5px 0';
      div.innerHTML = `<strong>${msg.user || 'åŒ¿å'}</strong> ${new Date(msg.timestamp).toLocaleTimeString()}<br>${msg.text}`;
      document.getElementById('messages').appendChild(div);
    }

    async function pollMessages() {
      try {
        const res = await fetch(`${WORKER_URL}/api/messages`);
        const messages = await res.json();
        const container = document.getElementById('messages');
        container.innerHTML = '';
        messages.forEach(displayMessage);
      } catch (e) {
        console.error('æ‹‰å–å¤±è´¥', e);
      }
    }

    async function sendMessage() {
      try {
        const user = document.getElementById('username').value.trim() || 'åŒ¿å';
        const text = document.getElementById('message').value.trim();
        if (!text) return;
        await fetch(`${WORKER_URL}/api/messages`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user, text }),
        });
        document.getElementById('message').value = '';
        pollMessages();
      } catch (e) {
        console.error('å‘é€å¤±è´¥', e);
        alert('å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°');
      }
    }

    setInterval(pollMessages, 2000);
    window.onload = () => {
      pollMessages();
      document.getElementById('send').onclick = sendMessage;
      document.getElementById('message').onkeypress = (e) => {
        if (e.key === 'Enter') sendMessage();
      };
    };
  </script>
</body>
</html>